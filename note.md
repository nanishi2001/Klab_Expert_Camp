# [Day1](https://docs.google.com/presentation/d/1wxo2_gneaRD5I1vNLjqiFinhNKioBZxgDkdt4YNxPH8/edit#slide=id.gd328c3072b_0_1727)
ある程度時間をかけて自作プロトコルスタックの骨格をくみ上げる
## ネットワーク基礎知識のおさらい
### TCP/IPのアーキテクチャ
* OSI参照モデル
    <dl>
        <dt>アプリケーション層</dt>
        <dt>プレゼンテーション層</dt>
        <dt>セッション層</dt>
        <dt>トランスポート層</dt>
        <dt>ネットワーク層</dt>
        <dt>データリンク層</dt>
        <dt>物理層</dt>
    </dl>

* TCP/IP
    <dl>
        <dt>アプリケーション層</dt>
        <dd>アプリケーションプロセス固有のやり取り</dd>
        <dt>トランスポート層</dt>
        <dd>ノード上のアプリケーションプロセス層のデータ転送</dd>
        <dt>インターネット層</dt>
        <dd>異なるネットワークに存在するノード間でのデータ転送</dd>
        <dt>ネットワークインターフェース層</dt>
        <dd>媒体上で直接接続されているノード間のデータ転送</dd>
    </dl>

### プロトコルスタック
複数のプロトコルが協調して動作する
* 各階層には責務を果たすための様々なプロトコルが存在する
* 同じ改装や上下の回想のプロトコルと連携しながら通信を成立させる
    <dl>
        <dt>トランスポート層</dt>
        <dd>UDP, TCP</dd>
        <dt>インターネット層(ネットワーク層)</dt>
        <dd>IP, IPv6, ARP, ICMP</dd>
        <dt>ネットワークインターフェース層(リンク層)</dt>
        <dd>Ethernet, SLIP, PPP, SDH</dd>
    </dl>

### データの流れ
各階層がデータ転送に必要な情報をヘッダとして付与(カプセル化)

### アプリケーションとプロトコルスタックの関係
アプリケーションは**ソケット**を通じてプロトコルスタックの機能を利用する
:::note
ソケットとは
各ネットワーク機器が外部とやり取りする際の窓口のこと
:::

- - -

## 開発環境とリファレンス実装の説明
### 開発環境
各自のLinux開発環境で作業
* Ubuntu 20.04を推奨
    * 実機or仮想環境のどちらでもOK(WindowsのWSL2で動作確認済み)
    * Dockerで構築する場合は--privilegedまたは--cap-add=NET_ADMINが必要
* 必要パッケージ(Ubuntuの場合)
    * build-essential
    * git
    * iproute2
    * iputlis-ping
    * netcat-openbsd
* 開発環境からインターネットへ接続できること

### リファレンス実装

https://github.com/pandax381/microps

* 学習用のTCP/IPプロトコルスタック
    * Ethernet/ARP/IP/ICMP/UDP/TCPをすべて自前で実装
    * 10年くらい細々と作り続けている(5世代目くらい)
    * C言語で4,5000行程度(一番大きなtcp.cが1500行)
    * 教育用OSへの移植実績あり[GitHubリンク](https://github.com/pandax381/mikanos-net)
* GitHubでレポジトリをforkしたものを手元にcloneする
    * masterブランチが最新のコード
    * 講義で解説するコードはこれを少しだけ簡略化している
* チュートリアルのとおり動かしてみよう

### microps
ユーザアプリケーション用のライブラリとして実装
* OSのプロトコルスタックを通さずにパケットを処理する

### 初期コード
いかのコミットおチェックアウトして初期コードとして使用する
